#!/usr/bin/env bash
set -euo pipefail

BASE_DIR="$HOME/.local"

source "$BASE_DIR/lib/tallyman/config.sh"
source "$BASE_DIR/lib/tallyman/utils.sh"
source "$BASE_DIR/lib/tallyman/render.sh"
source "$BASE_DIR/lib/tallyman/table.sh"
source "$BASE_DIR/lib/tallyman/usage.sh"

for f in "$BASE_DIR/lib/tallyman/commands/"*.sh; do
  source "$f"
done

cmd="${1:-list}"

case "$cmd" in
  -h|--help) usage ;;
  ""|list)
    [ "${1:-}" = "list" ] && shift
    cmd_list "$@"
    ;;
  add) shift; cmd_add "$@" ;;
  done) shift; cmd_done "$@" ;;
  edit) shift; cmd_edit "$@" ;;
  stats) shift; cmd_stats "$@" ;;
  archive) shift; cmd_archive "$@" ;;
  *)
    echo "tallyman: unknown command '$cmd'" >&2
    echo >&2
    usage >&2
    exit 1
    ;;
esac
